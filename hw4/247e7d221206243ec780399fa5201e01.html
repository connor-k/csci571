<!DOCTYPE html>
<html lang="en">
<html>
<head>
<meta charset="UTF-8">
<title>ckerns HW4 - XML</title>

<script>
function generateHTML(xmlDoc) {
    // MS parser doesn't define Node.ELEMENT_NODE
    var ELEMENT_NODE = 1;
    // TODO looks like they used a lot of globals -- remove them later
    root = xmlDoc.DocumentElement;
    debug = xmlDoc;
    html_text = "<html><head><title>XML Parse Result</title></head><body>";
    html_text += "<table border='2'>";
    table = xmlDoc.getElementsByTagName("Table").item(0).children;
    // Check that there's data
    if (table.length < 2) {
        throw("Error in XML file: Missing tags."); //TODO check
    }
    // Titles
    tableTitleSection = table[0];
    if (tableTitleSection.nodeName != "Header") {
        throw("Error in XML file: Missing header tag as first element.");
    }
    html_text += "<thead><tr>";
    tableColTitles = tableTitleSection.children;
    for (var i = 0; i < tableColTitles.length; i++) {
        // Check that it's an element node
        if (tableColTitles[i].nodeName == "Data" && tableColTitles[i].nodeType == ELEMENT_NODE) {
            var colName = tableColTitles[i].innerHTML;
            html_text += "<th>" + colName + "</th>";
            //TODO check if can be empty?
        } else {
            throw("Error in XML file: invalid data tag in headers.");
        }
    }
    html_text += "</tr></thead>";
    html_text += "<tbody>"
    /*
    planeNodeList = planes.item(0).childNodes;
    html_text += "<tbody>";
    html_text += "<tr>";
    var x = 0;
    var y = 0;
    // Output the headers
    for (var i = 0; i < planeNodeList.length; i++) {
        if (planeNodeList.item(i).nodeType == ELEMENT_NODE) {
            header = planeNodeList.item(i).nodeName;
            if (header == "Call Sign") {
                header = "Call Sign";
                x = 120;
                y = 55;
            } else if (header == "Boeing") {
                header="Family";
                x = 100;
                y = 67;
            } else if (header == "seats") {
                header = "Seats";
            } else if (header == "Wingspan") {
                header = "Wing Span";
            } else if (header == "height") {
                header = "Height";
            }
            html_text += "<th>" + header + "</th>";
        }
    }
    html_text += "</tr>";
    // Output out the values for all planes
    for (var i = 0; i < planes.length; i++) {
        // Get properties of a plane
        planeNodeList=planes.item(i).childNodes;
        // Start a new row of the output table
        html_text += "<tr>";
        for (var j = 0; j < planeNodeList.length; j++) {
            if (planeNodeList.item(j).nodeType == ELEMENT_NODE) {
                //handle images separately
                if (planeNodeList.item(j).nodeName == "Image") {
                    html_text += "<td><img src='" + planeNodeList.item(j).firstChild.nodeValue + "' width='" + x + "' height='" + y + "'></td>";
                } else {
                    html_text += "<td>" + planeNodeList.item(j).firstChild.nodeValue + "</td>";
                }
            }
        }
        html_text += "</tr>";
    }*/
    html_text += "</tbody>";
    html_text += "</table>";
    html_text += "</body></html>";
}

function viewXML(what) {
    var URL = what.URL.value;    
    function loadXML(url) {
        // Code for IE7+, Firefox, Chrome, Opera, Safari
        if (window.XMLHttpRequest) {
            xmlhttp = new XMLHttpRequest();
        } else {
            // Code for IE6, IE5
            xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
        }
        xmlhttp.open("GET", url, false);
        try {
            xmlhttp.send();
        } catch (e) {
            alert(e);
        }
        xmlDoc = xmlhttp.responseXML;
        return xmlDoc;
    }
    xmlDoc = loadXML(URL);
    // If IE, simply execute script (due to async prop).
    if (window.ActiveXObject) {
        if (xmlDoc.parseError.errorCode != 0) {
            var myErr = xmlDoc.parseError;
            error("Error in XML file");
            hWin = window.open("", "Error", "height=300,width=340");
            hWin.document.write(html_text);
        } else {
            generateHTML(xmlDoc);
            hWin = window.open("", "Assignment4", "height=800,width=600");
            hWin.document.write(html_text);
        }
    } else {
        // Else if FF, execute script once XML object has loaded
        try {
            xmlDoc.onload = generateHTML(xmlDoc);
            hWin = window.open("", "Assignment4", "height=800,width=600");
            hWin.document.write(html_text);
            hWin.document.close();
        } catch (e) {
            alert(e);
        }
    }
}
</script>
</head>

<body>
<div align="center">
    <p>Enter URL for Company List XML File</p>
    <form>
        <input type="text" name="URL" maxlength="255" size="20" />
        <br><br>
        <input type="button" name="submit" value="Submit Query" onClick="viewXML(this.form)" />
    </form>
</div>
<noscript>
</body>
</html>
